#! /bin/sh /usr/share/dpatch/dpatch-run
## 99_fix_XSS.dpatch by Alexander Wirt <formorer@debian.org>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: Fix for CVE-2011-2179 (#629127)
## DP: http://tracker.nagios.org/view.php?id=224

@DPATCH@
diff -urNad '--exclude=CVS' '--exclude=.svn' '--exclude=.git' '--exclude=.arch' '--exclude=.hg' '--exclude=_darcs' '--exclude=.bzr' pkg-nagios3~/cgi/config.c pkg-nagios3/cgi/config.c
--- pkg-nagios3~/cgi/config.c	2011-05-22 08:22:20.000000000 +0200
+++ pkg-nagios3/cgi/config.c	2011-06-04 09:36:40.208175645 +0200
@@ -2275,7 +2275,7 @@
 	if ((*to_expand)!='\0'){
 		arg_count[0]=0;
 
-		printf("<TR CLASS='dataEven'><TD CLASS='dataEven'>To expand:</TD><TD CLASS='dataEven'>%s",command_args[0]);
+		printf("<TR CLASS='dataEven'><TD CLASS='dataEven'>To expand:</TD><TD CLASS='dataEven'>%s",escape_string(command_args[0]));
 		for (i=1;(i<MAX_COMMAND_ARGUMENTS)&&command_args[i];i++)
 			printf("!<FONT\n   COLOR='%s'>%s</FONT>",hash_color(i),command_args[i]);
 		printf("\n</TD></TR>\n");
