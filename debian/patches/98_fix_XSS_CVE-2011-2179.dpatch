#! /bin/sh /usr/share/dpatch/dpatch-run
## 98_fix_XSS_CVE-2011-2179.dpatch by Alexander Wirt <formorer@debian.org>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: fix cross site scripting vulnerability in config.cgi on config expander arguments
## DP: CVE-2011-2179

@DPATCH@
diff -urNad '--exclude=CVS' '--exclude=.svn' '--exclude=.git' '--exclude=.arch' '--exclude=.hg' '--exclude=_darcs' '--exclude=.bzr' pkg-nagios3~/cgi/config.c pkg-nagios3/cgi/config.c
--- pkg-nagios3~/cgi/config.c	2011-05-22 08:22:20.000000000 +0200
+++ pkg-nagios3/cgi/config.c	2011-06-04 20:13:24.388437809 +0200
@@ -426,7 +426,7 @@
 				error=TRUE;
 				break;
 			        }
-			strncpy(to_expand,variables[x],MAX_COMMAND_BUFFER);
+			strncpy(to_expand,escape_string(variables[x]),MAX_COMMAND_BUFFER);
 			to_expand[MAX_COMMAND_BUFFER-1]='\0';
 		        }
 
