#! /bin/sh /usr/share/dpatch/dpatch-run
## 99_fix_XSS_CVE-2011-1523.dpatch by Alexander Wirt <formorer@debian.org>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: Fix for CVE-2011-1523 (#629127)
## DP: http://tracker.nagios.org/view.php?id=207

@DPATCH@
diff -urNad '--exclude=CVS' '--exclude=.svn' '--exclude=.git' '--exclude=.arch' '--exclude=.hg' '--exclude=_darcs' '--exclude=.bzr' pkg-nagios3~/cgi/statusmap.c pkg-nagios3/cgi/statusmap.c
--- pkg-nagios3~/cgi/statusmap.c	2011-05-22 08:22:20.000000000 +0200
+++ pkg-nagios3/cgi/statusmap.c	2011-06-04 09:41:55.642532781 +0200
@@ -2404,7 +2404,7 @@
 
 	for(temp_layer=layer_list;temp_layer!=NULL;temp_layer=temp_layer->next){
 		if(get_method==TRUE)
-			printf("&layer=%s",temp_layer->layer_name);
+			printf("&layer=%s",escape_string(temp_layer->layer_name)); 
 		else
 			printf("<input type='hidden' name='layer' value='%s'>\n",escape_string(temp_layer->layer_name));
 	        }
